<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Add Friends- EquiSplit</title>
    <!-- Favicons -->
    <link href="img/favicon.png" rel="icon">
    <link href="img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="vendor/quill/quill.snow.css" rel="stylesheet">
    <link href="vendor/quill/quill.bubble.css" rel="stylesheet">
    <link href="vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="vendor/simple-datatables/style.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="css/style.css" rel="stylesheet">
</head>


<body class="">

    <!-- Start Header Area -->

    <%- include("Header") %>
        <!-- End Header Area -->


        <!-- Start Sidebar Area -->

        <%- include("Sidebar") %>
            <!-- End Sidebar Area -->

            <main id="main" class="main">

                <div class="pagetitle">
                    <h1>Add Friends</h1>
                    <nav>
                      <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Friends</a></li>
                        <li class="breadcrumb-item active">Add Friends</li>
                      </ol>
                    </nav>
                  </div><!-- End Page Title -->
                  <section class="section dashboard">
                    
                    <div class="row  d-flex ">  
                    <div class="search-bar align-self-center">
                    <form class="search-form d-flex align-items-center" action="#">

                        <input type="text" class="form-control" id="search" name="search" placeholder="Search..." >
                        <button  type="button" class="btn btn-primary " onclick="fetchData()">Search</button>
                    </form>
                </div>

                
                </div>
           

                <div class="row m-5">

                    <div class="card">

                        <div class="card-title"> <h2>Result</h2></div>
                        <div class="card-body" id="data-container">
                          
                            <ul class="list-group mt-3" id="peopleList">
                               
                              </ul>
                   
                        </div>
                </div>


                </div>


                  </section>


            </main>



            <!-- Links of JS files -->
            <!-- Vendor JS Files -->
            <script src="vendor/apexcharts/apexcharts.min.js"></script>
            <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
            <script src="vendor/chart.js/chart.umd.js"></script>
            <script src="vendor/echarts/echarts.min.js"></script>
            <script src="vendor/quill/quill.js"></script>
            <script src="vendor/simple-datatables/simple-datatables.js"></script>
            <script src="vendor/tinymce/tinymce.min.js"></script>
            <script src="vendor/php-email-form/validate.js"></script>

            <!-- Template Main JS File -->
            <script src="js/main.js"></script>

            <script src="js/jquery.min.js"></script>
           



            <script>
                
$(document).ready(function() {
   

   

   

    // Detect scroll event to trigger fetching more data
    $(window).scroll(function() {
        if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
            fetchData(); // Load more data when scrolled near bottom
        }
    });
});

let page = 1;
const limit = 10; // Number of items to fetch per page
 // Function to fetch data from server
 function fetchData() {
        const keyword=$("#search").val();

        
        $.ajax({
            url: 'getuserlist',
            method: 'GET',
            data: { page: page, limit: limit,keyword:keyword },
            success: function(response) {
                if (response.length > 0) {
                    // Append fetched data to the DOM
                    response.forEach(item => {
                        // Append data to your container element
                        $('#peopleList').append(formatList(item.userid,item.firstname+" "+item.lastname,item.emailid));
                    });
                    page++; // Increment page number for the next fetch
                } else {
                    // No more data available
                    $('#scroll-info').text('End of data');
                }
            },
            error: function(err) {
                console.error('Error fetching data:', err);
            }
        });
    }




    function formatList(id, name, email){

        const html = "<li class='list-group-item'><div class='d-flex justify-content-between align-items-center'> "+
            " <div><h5 class='mb-1'>"+name+"</h5>"+
                "<small>"+email+"</small>"+
             " </div> "+
                "<button class='btn btn-primary btn-sm' onclick='addFriend("+id+")'>Add Friend</button>"+
                "</div> </li>"

        return html;        
    }


    function addFriend(id){
        $.ajax({
            url: 'sendRequest',
            method: 'GET',
            data: { friendid: id},
            success: function() {
                   
            },
            error: function(err) {
                console.error('Error fetching data:', err);
            }
        });

    }



            </script>


</body>

</html>